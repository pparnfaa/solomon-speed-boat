name: Rust

on:
  push:
    branches: [ "main" ]
    paths:
      - "backend/**"

env:
  CARGO_TERM_COLOR: always

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    - name: Build
      run: |
        cd backend
        cargo build --verbose
    - name: Run tests
      run: |
        cd backend
        cargo test --verbose
  
  # üîî Notify on Success or Failure
  notify:
    name: Discord Notification
    runs-on: ubuntu-latest
    needs: [build]
    if: always()
    steps:
      - name: Notify on Failure
        if: failure()
        uses: nobrayner/discord-webhook@v1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          discord-webhook: ${{ secrets.DISCORD_WEBHOOK }}
          message: |
            ‚ùå A job failed on `${{ github.ref }}` by `${{ github.actor }}`.
            Please check the logs.
          include-details: 'true'

      - name: Notify on Success
        if: success()
        uses: nobrayner/discord-webhook@v1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          discord-webhook: ${{ secrets.DISCORD_WEBHOOK }}
          message: |
            ‚úÖ All jobs succeeded on `${{ github.ref }}` by `${{ github.actor }}`.
          include-details: 'true'
